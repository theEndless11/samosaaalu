{"version":3,"sources":["app.js"],"names":["document","addEventListener","response","username","displayMessage","_ref","message","mediaUrl","timestamp","chatChannel","channels","createElement","messageElement","className","toLocaleTimeString","time","getElementById","scrollTop","scrollHeight","Realtime","key","get","subscribe","data","messages","messageInput","fileInput","formData","uploadResponse","_ref2","uploadedMediaUrl","regeneratorRuntime","async","_context2","prev","next","value","trim","alert","abrupt","files","length","FormData","append","awrap","method","body","sent","json","t0","error","headers","JSON","stringify","t1","console","stop","event","target","_context3","innerHTML","_context","fetch","forEach"],"mappings":"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","file":"app.min.js","sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\r\n    let username = '';\r\n    const ably = new Ably.Realtime({ key: 'A2d_-A.1BaGMw:stl13eplJUOlO1UI5slUxDy9S17jg6FaoM9CsWQJYUk' });\r\n    const chatChannel = ably.channels.get('chat-channel');\r\n\r\n    // Function to display a message\r\n    function displayMessage({ username, message, mediaUrl, timestamp }) {\r\n        const messageElement = document.createElement('div');\r\n        messageElement.className = 'message';\r\n\r\n        const time = new Date(timestamp).toLocaleTimeString();\r\n        messageElement.innerHTML = `\r\n            <div class=\"msg-bubble ${username === 'you' ? 'user-msg' : 'bot-msg'}\">\r\n                <strong>${username}</strong> <span>(${time})</span><br>\r\n                ${message || ''}\r\n                ${mediaUrl ? `<br><img src=\"${mediaUrl}\" alt=\"Media\" style=\"max-width: 100%;\">` : ''}\r\n            </div>\r\n        `;\r\n\r\n        document.getElementById('messages-container').appendChild(messageElement);\r\n        document.getElementById('messages-container').scrollTop = document.getElementById('messages-container').scrollHeight;\r\n    }\r\n\r\n    // Fetch messages on load\r\n    async function fetchMessages() {\r\n        try {\r\n            const response = await fetch('/messages');\r\n            const messages = await response.json();\r\n            messages.forEach(displayMessage);\r\n        } catch (error) {\r\n            console.error('Error fetching messages:', error);\r\n        }\r\n    }\r\n\r\n    // Listen for new messages\r\n    chatChannel.subscribe('new-message', (message) => {\r\n        displayMessage(message.data);\r\n    });\r\n\r\n    // Handle message sending\r\n    document.getElementById('send-message-btn').addEventListener('click', async () => {\r\n        const messageInput = document.getElementById('user-message');\r\n        const fileInput = document.getElementById('file-input');\r\n        const message = messageInput.value.trim();\r\n\r\n        if (!username) {\r\n            alert(\"Please enter a username before sending a message.\");\r\n            return;\r\n        }\r\n\r\n        if (message || (fileInput && fileInput.files.length > 0)) {\r\n            let mediaUrl = '';\r\n\r\n            if (fileInput && fileInput.files.length > 0) {\r\n                const formData = new FormData();\r\n                formData.append('file', fileInput.files[0]);\r\n\r\n                try {\r\n                    const uploadResponse = await fetch('/upload', { method: 'POST', body: formData });\r\n                    const { mediaUrl: uploadedMediaUrl } = await uploadResponse.json();\r\n                    mediaUrl = uploadedMediaUrl;\r\n                } catch (error) {\r\n                    console.error('Error uploading file:', error);\r\n                    alert('Failed to upload file.');\r\n                    return;\r\n                }\r\n            }\r\n\r\n            try {\r\n                await fetch('/send-message', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ username, message, mediaUrl })\r\n                });\r\n            } catch (error) {\r\n                console.error('Error sending message:', error);\r\n                alert('Failed to send message.');\r\n            }\r\n\r\n            messageInput.value = '';\r\n            if (fileInput) fileInput.value = ''; // Clear the file input\r\n        } else {\r\n            alert(\"Message cannot be empty.\");\r\n        }\r\n    });\r\n\r\n    // Set username\r\n    document.getElementById('username-input').addEventListener('input', (event) => {\r\n        username = event.target.value.trim() || 'you';\r\n    });\r\n\r\n    // Clear chat\r\n    document.getElementById('clear-chat-btn').addEventListener('click', async () => {\r\n        try {\r\n            await fetch('/messages', { method: 'DELETE' });\r\n            document.getElementById('messages-container').innerHTML = '';\r\n        } catch (error) {\r\n            console.error('Error clearing chat:', error);\r\n            alert('Failed to clear chat.');\r\n        }\r\n    });\r\n\r\n    // Initial messages fetch\r\n    fetchMessages();\r\n});\r\n"]}