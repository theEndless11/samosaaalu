{"version":3,"sources":["send-message.js"],"names":["mongoose","require","Message","Ably","ably","Realtime","key","process","env","ABLY_KEY","channel","channels","get","module","exports","req","res","method","body","username","message","mediaUrl","status","json","error","newMessage","save","publish","timestamp","send","console"],"mappings":";;AAAA;AACA,IAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAC,sBAAD,CAAvB,C,CAAiD;;;AACjD,IAAME,IAAI,GAAGF,OAAO,CAAC,MAAD,CAApB;;AAEA,IAAMG,IAAI,GAAG,IAAID,IAAI,CAACE,QAAT,CAAkB;AAAEC,EAAAA,GAAG,EAAEC,OAAO,CAACC,GAAR,CAAYC;AAAnB,CAAlB,CAAb;AACA,IAAMC,OAAO,GAAGN,IAAI,CAACO,QAAL,CAAcC,GAAd,CAAkB,cAAlB,CAAhB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gBACTD,GAAG,CAACE,MAAJ,KAAe,MADN;AAAA;AAAA;AAAA;;AAAA,sBAE+BF,GAAG,CAACG,IAFnC,EAEDC,QAFC,aAEDA,QAFC,EAESC,OAFT,aAESA,OAFT,EAEkBC,QAFlB,aAEkBA,QAFlB;;AAAA,gBAIL,CAACF,QAAD,IAAc,CAACC,OAAD,IAAY,CAACC,QAJtB;AAAA;AAAA;AAAA;;AAAA,2CAKEL,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,YAAAA,KAAK,EAAE;AAAT,WAArB,CALF;;AAAA;AAQHC,UAAAA,UARG,GAQU,IAAIvB,OAAJ,CAAY;AAAEiB,YAAAA,QAAQ,EAARA,QAAF;AAAYC,YAAAA,OAAO,EAAPA,OAAZ;AAAqBC,YAAAA,QAAQ,EAARA;AAArB,WAAZ,CARV;AAAA;AAAA;AAAA,0CAWCI,UAAU,CAACC,IAAX,EAXD;;AAAA;AAaL;AACAhB,UAAAA,OAAO,CAACiB,OAAR,CAAgB,aAAhB,EAA+B;AAAER,YAAAA,QAAQ,EAARA,QAAF;AAAYC,YAAAA,OAAO,EAAPA,OAAZ;AAAqBC,YAAAA,QAAQ,EAARA,QAArB;AAA+BO,YAAAA,SAAS,EAAEH,UAAU,CAACG;AAArD,WAA/B;AAEAZ,UAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBO,IAAhB,CAAqB,cAArB;AAhBK;AAAA;;AAAA;AAAA;AAAA;AAkBLC,UAAAA,OAAO,CAACN,KAAR,CAAc,uBAAd;AACAR,UAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,YAAAA,KAAK,EAAE;AAAT,WAArB;;AAnBK;AAAA;AAAA;;AAAA;AAsBTR,UAAAA,GAAG,CAACM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,YAAAA,KAAK,EAAE;AAAT,WAArB;;AAtBS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAjB","sourcesContent":["// api/send-message.js\r\nconst mongoose = require('mongoose');\r\nconst Message = require('../../models/Message'); // Assuming you put your model in a separate file\r\nconst Ably = require('ably');\r\n\r\nconst ably = new Ably.Realtime({ key: process.env.ABLY_KEY });\r\nconst channel = ably.channels.get('chat-channel');\r\n\r\nmodule.exports = async (req, res) => {\r\n    if (req.method === 'POST') {\r\n        const { username, message, mediaUrl } = req.body;\r\n\r\n        if (!username || (!message && !mediaUrl)) {\r\n            return res.status(400).json({ error: 'Username and either message or media are required' });\r\n        }\r\n\r\n        const newMessage = new Message({ username, message, mediaUrl });\r\n\r\n        try {\r\n            await newMessage.save();\r\n\r\n            // Publish message to Ably\r\n            channel.publish('new-message', { username, message, mediaUrl, timestamp: newMessage.timestamp });\r\n\r\n            res.status(200).send('Message sent');\r\n        } catch (error) {\r\n            console.error('Error saving message:', error);\r\n            res.status(500).json({ error: 'Error saving message' });\r\n        }\r\n    } else {\r\n        res.status(405).json({ error: 'Method Not Allowed' });\r\n    }\r\n};\r\n"],"file":"send-message.dev.js"}