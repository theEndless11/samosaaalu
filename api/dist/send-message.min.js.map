{"version":3,"sources":["send-message.js"],"names":["mongoose","require","Message","Realtime","key","process","env","ABLY_KEY","channel","ably","channels","get","module","Ably","req","res","method","body","mediaUrl","username","message","json","error","newMessage","save","timestamp","status","send","console","_context","t0"],"mappings":"aACA,IAAMA,SAAWC,QAAQ,YADzBC,QAAAD,QAAA,wBACMD,KAAQC,QAAGA,QACXC,KAAO,IAAGD,KAAQE,SAAA,CAAAC,IAAAC,QAGsBC,IAHGC,WAI3CC,QAAUC,KAAKC,SAASC,IAAI,gBAHlCC,OAAMC,QAAOZ,SAAQa,EAArBC,GAAad,IAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EAAAA,OAAAA,mBAAAA,MAAAA,SAAAA,GAAAA,OAAAA,OAAAA,EAAAA,KAAAA,EAAAA,MAAAA,KAAAA,EAAAA,GAMU,SAAfa,EAAIE,OANCf,CAAAA,EAAAA,KAAAA,GAAAA,MAAAA,GAAAA,EAEkBa,EAAAG,KAAdJ,EAFJZ,EAEIY,SAAKV,EAFTF,EAESE,QAASe,EAFlBjB,EAEkBiB,SAA/BC,IAAAC,GAAAF,GAFajB,CAAAA,EAAAA,KAAAA,EAAAA,MAAAA,OAAAA,EAAAA,OAAAA,SAGQS,EAAAA,OAASC,KAAIU,KAAA,CAAAC,MAAlC,uDAHarB,KAAAA,EAAAA,OAKIsB,EAAA,IAAArB,QAAA,CAAAiB,SAAAA,EAAAC,QAAAA,EAAAF,SAAAA,IALJjB,EAAAA,KAAAA,EAAAA,EAAAA,KAAAA,EAAAA,mBAAAA,MAKIsB,EAAAC,QALJvB,KAAAA,EAKIO,QACLQ,QAAJ,cADS,CAAAG,SAAAA,EAAAC,QAAAA,EAAAF,SAAAA,EAAAO,UAAAF,EAAAE,YAAAV,EAAAW,OAAA,KAAAC,KAAA,gBALJ1B,EAAAA,KAAAA,GAAAA,MAAAA,KAAAA,GAAAA,EAAAA,KAAAA,GAAAA,EAAAA,GAAAA,EAAAA,MAAAA,GAuBD2B,QAAQN,MAAM,wBAAdO,EAAAC,IAlBKf,EAAAW,OAE+BZ,KAAIG,KAApCE,CAAAA,MAFC,yBALJlB,KAAAA,GAAAA,EAAAA,KAAAA,GAAAA,MAAAA,KAAAA,GAKIc,EAAAW,OAAA,KAAAL,KAAA,CAAAC,MAAA,uBALJrB,KAAAA,GAAAA,IAAAA,MAAAA,OAAAA,EAAAA,SAAAA,KAAAA,KAAAA,CAAAA,CAAAA,EAAAA","file":"send-message.min.js","sourcesContent":["// api/send-message.js\r\nconst mongoose = require('mongoose');\r\nconst Message = require('../../models/Message'); // Assuming you put your model in a separate file\r\nconst Ably = require('ably');\r\n\r\nconst ably = new Ably.Realtime({ key: process.env.ABLY_KEY });\r\nconst channel = ably.channels.get('chat-channel');\r\n\r\nmodule.exports = async (req, res) => {\r\n    if (req.method === 'POST') {\r\n        const { username, message, mediaUrl } = req.body;\r\n\r\n        if (!username || (!message && !mediaUrl)) {\r\n            return res.status(400).json({ error: 'Username and either message or media are required' });\r\n        }\r\n\r\n        const newMessage = new Message({ username, message, mediaUrl });\r\n\r\n        try {\r\n            await newMessage.save();\r\n\r\n            // Publish message to Ably\r\n            channel.publish('new-message', { username, message, mediaUrl, timestamp: newMessage.timestamp });\r\n\r\n            res.status(200).send('Message sent');\r\n        } catch (error) {\r\n            console.error('Error saving message:', error);\r\n            res.status(500).json({ error: 'Error saving message' });\r\n        }\r\n    } else {\r\n        res.status(405).json({ error: 'Method Not Allowed' });\r\n    }\r\n};\r\n"]}